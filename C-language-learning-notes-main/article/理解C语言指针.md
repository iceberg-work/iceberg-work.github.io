# 理解C语言指针

指针是储存地址的变量（数据对象），地址对于计算机而言就是变量的名字。

## 指针的属性

指针不同于普通变量，其基本量是地址，通过\*运算符获得的派生量是值（普通变量的基本量是值，派生量指的是通过&运算符获得的地址）。可以这样说，指针颠倒了普通变量值与地址的关系。

**注意**

指针的类型也是指针的属性之一。

`int (*p)[i]`声明了一个指针数组，这时p是指向一维数组的指针。

`int (**p)[i]`应该声明了一个指向指针数组的指针。

## 指针的使用

使用指针离不开取地址运算符&和解引用（间接）运算符\*，在结构体指针中需要用成员运算（Member Access Operator)-\>来访问成员变量（基于运算符优先级，“p-\>a”可以用“(\*p).a”代替）。

**注意**

未赋值的指针不要解引用，因为这样可能导致程序发生一些错误。

### 指针的使用情景

- 1.指向其他变量
    - 这种情况便是一般意义的指针，函数指针可以用于回调函数，从而减小耦合程度
- 2.指向自己
    - 此时，指针的基本量就是自己的地址，p、\*p、&p三值相等

**注意**

对于数组，尽管p和&p相等（都等于数组的首地址），但意义不同，&p是指向数组的指针，p是指向和数组同一类型的变量的指针。

### 指针算术

指针算术分为加法和减法，可以将值增减`sizeof(p)`

**注意**

一般不对两个指针做减法，因为这样做很可能得到错误的结论，除非在同一数组中。

## 指针的意义

使用指针可以减小内存开销，对于计算机而言直接操作地址可以提高效率。

## 变相使用指针

所谓变相使用指针，说的其实就是指针指向自己的情况，C语言的数组（字符串是char类型的数组）、结构体和函数（函数只有在被调用的情况下才会写入主存中）都是变相地使用指针的产物。

**注意**

数组并不是指针，用指针表示数组时不能做指针算术运算。

### 变相使用指针的简写情况

对于数组，a[i]和[i]a的意义相同，这是因为\*(a + 1)和\*(i + a)的意义相同，a[i]是\*(a + 1)的简写。

## 特殊指针

- 1.空指针
- 2.块指针
- 3.指向指针的指针
- 4.通用指针（void指针）

### 空指针

空指针不是野指针，通常是0或NULL，建议使用NULL。合理使用空指针可以有效避免内存泄漏，提高程序的执行效率。

### 块指针

大概是指向代码块的指针

### 指向指针的指针

\*\*p并不能表示二维数组，`int **p`是声明一个指向int指针的指针。

\*(\*(p+i)+j)表示任意一个i行j列的元素。

### 通用指针（void指针）

这种指针可被赋值，但不能做算术运算；划分堆内存时的返回值就是void指针，这时需要进行强制类型转换。

## 指针与动态内存

这一部分需要用到堆内存，在C语言中会用到`malloc`、`calloc`、`realloc`和`free`，在C++中会用到`new`和`delete`。
